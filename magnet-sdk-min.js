/*!*
     * @fileoverview Magnet Mobile Server SDK for JavaScript
     *
     * @version 2.3.0
     */
!function(a){function b(a,b,c){return a.replace("{"+b+"}",c)}function c(a,b){return"&"+a+"="+("object"==typeof b?JSON.stringify(b):b)}function d(a,b){return a+"="+("object"==typeof b?JSON.stringify(b):b)}function e(a){return-1!=a.indexOf("[]")?a.replace("[]",""):a}function f(a){for(var b="BOUNDARY",c=g(a,b),d=h(c[0]),e=1;e<c.length;++e)i(d,c[e]);return d}function g(a,b){var c=a.split("--"+b);return c.shift(),c.pop(),c}function h(b){for(var c,d=b,e=b.split("\r\n"),f=0;f<e.length;++f)if(-1!=e[f].indexOf("Content-Type")){c=e[f].replace(/Content-Type[ ]*:/,"").replace(/^\s+|\s+$/g,""),d=d.replace(e[f],"");break}return"application/json"==c?a.Utils.getValidJSON(d):d}function i(b,c){var d,e,f={};f.val=c;for(var g=c.split("\r\n"),h=0;h<g.length;++h)if(-1!=g[h].indexOf("Content-Type")&&(f.mimeType=g[h].replace(/Content-Type[ ]*:/,"").replace(/^\s+|\s+$/g,""),f.val=f.val.replace(g[h],"")),-1!=g[h].indexOf("Content-Transfer-Encoding")&&(d=g[h].replace(/Content-Transfer-Encoding[ ]*:/,"").replace(/^\s+|\s+$/g,""),f.val=f.val.replace(g[h],"")),-1!=g[h].indexOf("Content-Id")){e=g[h].replace(/Content-Id[ ]*:/,"").replace(/^\s+|\s+$/g,""),f.val=f.val.replace(g[h],"");break}f.val="base64"==d?a.Utils.base64ToString(f.val.replace(/(\r\n|\n|\r)/gm,"")):"application/json"==f.mimeType?a.Utils.getValidJSON(f.val):a.Utils.isNode||"application/xml"!=f.mimeType&&"text/xml"!=f.mimeType?f.val.replace(/^\s+|\s+$/g,""):a.Utils.getValidXML(f.val),j(b,e,f)}function j(b,c,d){for(var e in b)a.Utils.isObject(b[e])||a.Utils.isArray(b[e])?j(b[e],c,d):b[e]==c&&(b[e]=d)}function k(b,c,d,e){for(var f in b)b.hasOwnProperty(f)&&b[f]&&("undefined"!=typeof e&&"undefined"!=typeof e[f]&&(e[f].type=e[f].type.trim()),b[f].isMagnetModel&&b[f].attributes?b[f]=k(b[f].attributes,c,b[f]):a.Utils.isArray(b[f])?b[f]=k(b[f],c):"undefined"!=typeof e&&e[f]&&a.Utils.isDateType(e[f].type)?b[f]="string"==typeof b[f]?b[f]:a.Utils.dateToISO8601(b[f]):"undefined"!=typeof e&&e[f]&&"bytearray"==e[f].type?b[f]=a.Utils.stringToBase64(b[f]):c&&"undefined"!=typeof d&&d.schema[f]&&("_data"==d.schema[f].type||"binary"==d.schema[f].type)&&(b[f]=c.add(b[f].mimeType,b[f].val)));return b}function l(){a.Storage.get(a.CallManager.queueTableName,null,function(b){for(var c=0;c<b.length;++c)a.CallManager.queues[b[c].queueName]=a.CallManager.queues[b[c].queueName]||[],a.CallManager.queues[b[c].queueName].push({id:b[c].id,callId:b[c].callId,callOptions:a.Utils.getValidJSON(b[c].callOptions),options:a.Utils.getValidJSON(b[c].options),metadata:a.Utils.getValidJSON(b[c].metadata),queueName:b[c].queueName})})}a.Config={endpointUrl:"",logging:!0,storeCredentials:!1,debugMode:!1,sdkVersion:"2.3.0"},String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),a.Utils={isAndroid:"undefined"!=typeof navigator&&navigator.userAgent?/Android|webOS/i.test(navigator.userAgent):!1,isIOS:"undefined"!=typeof navigator&&navigator.userAgent?/iPhone|iPad|iPod/i.test(navigator.userAgent):!1,isMobile:"undefined"!=typeof navigator&&navigator.userAgent?/Android|webOS|iPhone|iPad|iPod/i.test(navigator.userAgent):!1,isNode:"undefined"!=typeof module&&module.exports&&"undefined"==typeof window,isCordova:"undefined"!=typeof navigator&&navigator.userAgent&&"undefined"!=typeof window&&window.location&&window.location.href&&("undefined"!=typeof cordova||"undefined"!=typeof PhoneGap||"undefined"!=typeof phonegap)&&/^file:\/{3}[^\/]/i.test(window.location.href)&&/ios|iphone|ipod|ipad|android/i.test(navigator.userAgent),mergeObj:function(a,b){var a=a||{},b=b||{};for(var c in b)try{a[c]=b[c].constructor==Object?this.mergeObj(a[c],b[c]):b[c]}catch(d){a[c]=b[c]}return a},isObject:function(a){return"[object Object]"==Object.prototype.toString.call(a)},isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)},getValidJSON:function(a){try{a=JSON.parse(a)}catch(b){return!1}return a},getValidXML:function(a){this.parseXml||(window.DOMParser?this.parseXml=function(a){return(new window.DOMParser).parseFromString(a,"text/xml")}:"undefined"!=typeof window.ActiveXObject&&new window.ActiveXObject("Microsoft.XMLDOM")&&(this.parseXml=function(a){var b=new window.ActiveXObject("Microsoft.XMLDOM");return b.async="false",b.loadXML(a),b}));try{a=this.parseXml(a)}catch(b){return!1}return a},objectToFormdata:{stringify:function(b){if(a.Utils.isObject(b)){var c=[];for(var d in b)b.hasOwnProperty(d)&&null!=b[d]&&c.push(d+"="+encodeURIComponent(b[d]));return c.join("&")}return""}},getAttributes:function(a){var b=[];a=a||{};for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b},getValues:function(a){var b=[];a=a||{};for(var c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b},isEmptyObject:function(a){if(!a||"string"==typeof a||"boolean"==typeof a||this.isNumeric(a))return!0;if(a.hasOwnProperty){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}for(var b in a)return!1;return!0},convertHeaderStrToObj:function(a){var b={};if(Object.keys(a).forEach)Object.keys(a).forEach(function(c){"string"!=typeof a[c]&&"number"!=typeof a[c]&&"boolean"!=typeof a[c]||"responseText"==c||(b[c]=a[c])});else for(var c in a)"string"!=typeof a[c]&&"number"!=typeof a[c]&&"boolean"!=typeof a[c]||"responseText"==c||(b[c]=a[c]);var d=a.getAllResponseHeaders().split("\n");for(var e in d){var c=d[e].trim().split(": ");c.length>1&&(b[c[0]]=c[1])}return b},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},cleanData:function(a,b){var c={};for(var d in a)a.hasOwnProperty(d)&&b[d]&&(c[d]=b[d]);return c},validate:function(b,c,d){var e,f=[];c=c||{};for(var g in b)if(b.hasOwnProperty(g)){e={attribute:g};var h=b[g].type;"undefined"!=typeof b&&"undefined"!=typeof b[g]&&"undefined"!=typeof b[g].type&&(h=h.trim()),b[g].optional!==!1||"undefined"!=typeof c[g]&&""!==c[g]?!c[g]||"integer"!=h&&"biginteger"!=h&&"bigdecimal"!=h&&"double"!=h&&"long"!=h&&"float"!=h&&"short"!=h&&"byte"!=h||a.Utils.isNumeric(c[g])?c[g]&&"boolean"==h&&"true"!==c[g]&&c[g]!==!0&&"false"!==c[g]&&c[g]!==!1?e.reason="not boolean":!c[g]||"java.util.List"!=h&&"array"!=h||c[g]&&0!=c[g].length&&this.isArray(c[g])!==!1?!c[g]||"_data"!=h&&"binary"!=h||c[g].mimeType&&c[g].val||(e.reason="invalid binary format"):e.reason="empty list":e.reason="not numeric":d||(e.reason="required field blank"),e.reason&&f.push(e)}return 0==f.length?!1:f},hasFeature:function(a){try{return a in window&&null!==window[a]}catch(b){return!1}},isPrimitiveType:function(a){return-1!="|byte|short|int|long|float|double|boolean|char|string|integer|void|".indexOf("|"+a+"|")},getArrayType:function(a){return-1!=a.indexOf("[]")?a.slice(0,-2):!1},getDataType:function(a){var b;switch(Object.prototype.toString.call(a)){case"[object Number]":b="integer";break;case"[object String]":b="string";break;case"[object Array]":b="array";break;case"[object Object]":b="object";break;case"[object Date]":b="date";break;case"[object Boolean]":b="boolean"}return b},isDateType:function(a){return-1!="|date|".indexOf("|"+a+"|")==!0},isBinaryType:function(a){return-1!="|binary|_data|".indexOf("|"+a+"|")==!0},isGenericObject:function(a){return-1!="|object|".indexOf("|"+a+"|")==!0},isModelOrCollection:function(b){return a.Models[b]||a.Models[this.getArrayType(b)]?!0:!1},dateToISO8601:function(a){function b(a){return 10>a?"0"+a:a}return a.getUTCFullYear()+"-"+b(a.getUTCMonth()+1)+"-"+b(a.getUTCDate())+"T"+b(a.getUTCHours())+":"+b(a.getUTCMinutes())+":"+b(a.getUTCSeconds())+"Z"},ISO8601ToDate:function(b){if("string"!=typeof b)return!1;var c=/(\d{4})-(\d\d)-(\d\d)T(\d\d):(\d\d):(\d\d)(\.\d+)?(Z|([+-])(\d\d):(\d\d))/,d=[];if(d=b.match(c),!d)return a.Log("Couldn't parse ISO 8601 date string '"+b+"'"),!1;var e=[1,2,3,4,5,6,10,11];for(var f in e)d[e[f]]=parseInt(d[e[f]],10);d[7]=parseFloat(d[7]);var g=Date.UTC(d[1],d[2]-1,d[3],d[4],d[5],d[6]);if(d[7]>0&&(g+=Math.round(1e3*d[7])),"Z"!=d[8]&&d[10]){var h=60*d[10]*60*1e3;d[11]&&(h+=60*d[11]*1e3),"-"==d[9]?g-=h:g+=h}return new Date(g)},stringToBase64:function(a){return this.isNode===!0&&"undefined"!=typeof Buffer?new Buffer(a).toString("base64"):window.btoa(unescape(encodeURIComponent(a)))},base64ToString:function(a){return this.isNode===!0&&"undefined"!=typeof Buffer?new Buffer(a,"base64").toString("utf8"):decodeURIComponent(escape(window.atob(a)))},getGUID:function(){var a=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"==b?c:7&c|8).toString(16)})}},a.Promise=function(){this.successes=[],this.failures=[]},a.Promise.prototype={successes:null,failures:null,status:"pending",args:null,_isPromise:!0,then:function(b,c){var d=new a.Deferred;return b&&this.successes.push({fn:b,defer:d}),c&&this.failures.push({fn:c,defer:d}),"resolved"===this.status?this.exec({fn:b,defer:d},this.args):"rejected"===this.status&&this.exec({fn:c,defer:d},this.args),d.promise},success:function(b){var c=new a.Deferred;return b&&this.successes.push({fn:b,defer:c}),"resolved"===this.status&&this.exec({fn:b,defer:c},this.args),this},error:function(b){var c=new a.Deferred;return b&&this.failures.push({fn:b,defer:c}),"rejected"===this.status&&this.exec({fn:b,defer:c},this.args),this},exec:function(b,c){setTimeout(function(){var d=b.fn.apply(null,c);a.Utils.isObject(d)&&d._isPromise&&b.defer.bind(d)},0)}},a.Deferred=function(){this.promise=new a.Promise},a.Deferred.prototype={promise:null,resolve:function(){var a=this.promise;a.args=arguments,a.status="resolved";for(var b=0;b<a.successes.length;++b)a.exec(a.successes[b],a.args)},reject:function(){var a=this.promise;a.args=arguments,a.status="rejected";for(var b=0;b<a.failures.length;++b)a.exec(a.failures[b],a.args)},bind:function(a){var b=this;a.then(function(){b.resolve.apply(b,arguments)},function(){b.reject.apply(b,arguments)})}},a.Deferred.all=function(){for(var b=new a.Deferred,c=[],d=[],e=0,f=arguments.length,g=0;f>g;++g)arguments[g].call(null).then(function(){c.push(arguments),++e==f&&b.resolve(c,d)},function(){d.push(arguments),++e==f&&b.resolve(c,d)});return b.promise},a.Events={create:function(a){return a._events||a.invoke||a.on||a.unbind?!1:(a._events={},a.on=function(b,c){a._events[b]=a._events[b]||[],a._events[b].push(c)},a.invoke=function(b){if(typeof b==typeof[]){for(var c=b.length;c--;)if(a._events[b[c]])for(var d=a._events[b[c]].length;d--;)a._events[b[c]][d].apply(this,[].slice.call(arguments,1))}else if(a._events[b])for(var e=a._events[b].length;e--;)a._events[b][e].apply(this,[].slice.call(arguments,1))},a.unbind=function(b){a._events[b]&&delete a._events[b]},!0)}},a.SQLConnector={db:void 0,schemas:{},dbOptions:{name:"MMSDK",version:"1.0",display:"Magnet_JS_SDK_DB",size:5e6},create:function(b,c,d,e){var f=this;f.db.transaction(function(e){var g=a.Utils.getAttributes(c).join(", "),h=a.Utils.getValues(c);a.Log("INSERT INTO "+b+" ("+g+") VALUES ("+f.getPlaceholders(h)+")",h),e.executeSql("INSERT INTO "+b+" ("+g+") VALUES ("+f.getPlaceholders(h)+")",h,function(a,b){c.id=b.insertId,d(c)})},function(b){a.Log("error inserting a record: ",b),e(b)})},update:function(b,c,d,e,f){this.db.transaction(function(f){delete d.id;var g=a.Utils.getAttributes(d).join("=?, ")+"=?",h=a.Utils.getValues(d);h.push(c),a.Log("UPDATE "+b+" SET "+g+" WHERE id=?",h),f.executeSql("UPDATE "+b+" SET "+g+" WHERE id=?",h,function(){e(d)})},function(b){a.Log("error updating a record: ",b),f(b)})},get:function(b,c,d,e){var f=this;f.db.transaction(function(g){("undefined"==typeof c||null===c||""===c)&&(c={1:1});var h,i,j="object"==typeof c;j?(h=a.Utils.getAttributes(c).join("=? AND ")+"=?",i=a.Utils.getValues(c)):(h="id=?",i=[c]),a.Log("SELECT * FROM "+b+" WHERE "+h,i),g.executeSql("SELECT * FROM "+b+" WHERE "+h,i,function(a,b){d(f.formatResponse(b.rows,j))},function(b){a.Log("error retrieving records: ",b),e(b)})},function(b){a.Log("error setting up web sql transaction: ",b),e(b)})},formatResponse:function(a,b){for(var c=[],d=0;d<a.length;++d)c.push(a.item(d));return b?c:c[0]},remove:function(b,c,d,e){var f=this;f.db.transaction(function(d){var e=[],g=[],h=[],i=[];if("object"==typeof c){for(var j in c)a.Utils.isArray(c[j])?(h.push(j+" IN ("+f.getPlaceholders(c[j])+")"),i=i.concat(a.Utils.getValues(c[j]))):(e.push(j+"=?"),g.push(c[j]));e=e.concat(h).join(" AND "),g=g.concat(i)}else e="id=?",g=[c];a.Log("DELETE FROM "+b+" WHERE "+e,g),d.executeSql("DELETE FROM "+b+" WHERE "+e,g)},function(b){a.Log("error deleting a record: ",b),e(b)},d)},clearTable:function(b,c,d){this.db.transaction(function(c){a.Log("DELETE FROM "+b),c.executeSql("DELETE FROM "+b)},function(b){a.Log("error clearing table: ",b),d(b)},c)},createTableIfNotExist:function(b,c,d,e,f,g){var h,i,j=this,k=["id INTEGER PRIMARY KEY AUTOINCREMENT"];if("object"==typeof c){for(var l in c)k.push(l+" "+c[l]);k=k.join(", "),j.schemas[b]=c}j.db.transaction(function(c){if(a.Log("CREATE TABLE IF NOT EXISTS "+b+" ("+k+")"),c.executeSql("CREATE TABLE IF NOT EXISTS "+b+" ("+k+")"),e===!0&&(a.Log("DELETE FROM "+b),c.executeSql("DELETE FROM "+b)),a.Utils.isArray(d))for(var f=0;f<d.length;++f)h=a.Utils.getAttributes(d[f]).join(", "),i=a.Utils.getValues(d[f]),a.Log("INSERT INTO "+b+" ("+h+") VALUES ("+j.getPlaceholders(i)+")",i),c.executeSql("INSERT INTO "+b+" ("+h+") VALUES ("+j.getPlaceholders(i)+")",i);else d&&(h=a.Utils.getAttributes(d).join(", "),i=a.Utils.getValues(d),a.Log("INSERT INTO "+b+" ("+h+") VALUES ("+j.getPlaceholders(i)+")",i),c.executeSql("INSERT INTO "+b+" ("+h+") VALUES ("+j.getPlaceholders(i)+")",i))},function(b){a.Log("error executing web sql transaction: ",b),g(b)},f)},getPlaceholders:function(a){for(var b=[],c=0;c<a.length;++c)b.push("?");return b.join(", ")}},a.LocalStorageConnector={create:function(b,c,d){setTimeout(function(){var e=a.Utils.getValidJSON(window.localStorage.getItem(b))||[];c.id=a.Utils.getGUID(),e.push(c),window.localStorage.setItem(b,JSON.stringify(e)),d(c)},1)},update:function(b,c,d,e,f){var g;setTimeout(function(){var h=a.Utils.getValidJSON(window.localStorage.getItem(b));if(h){for(var i=0;i<h.length;++i)if(h[i].id==c){for(var j in d)h[i][j]=d[j];g=h[i]}"undefined"==typeof g?f("record-not-exist"):(window.localStorage.setItem(b,JSON.stringify(h)),e(g))}else f("table-not-exist")},1)},get:function(b,c,d,e){var f=[],g=!0;setTimeout(function(){var h=a.Utils.getValidJSON(window.localStorage.getItem(b));if(h){if("object"==typeof c)for(var i=0;i<h.length;++i){for(var j in c)h[i][j]!==c[j]&&(g=!1);g===!0&&f.push(h[i]),g=!0}else if("undefined"==typeof c||null===c||""===c)f=h;else{f=void 0;for(var i=0;i<h.length;++i)if(h[i].id==c){f=h[i];break}}d(f)}else e("table-not-exist")},1)},remove:function(b,c,d,e){var f=!0;setTimeout(function(){var g=a.Utils.getValidJSON(window.localStorage.getItem(b));if(g){for(var h=g.length;h--;)if("object"==typeof c){f=!0;for(var i in c)a.Utils.isArray(c[i])?-1==c[i].indexOf(g[h][i])&&(f=!1):g[h][i]!==c[i]&&(f=!1);f&&g.splice(h,1)}else g[h].id==c&&g.splice(h,1);window.localStorage.setItem(b,JSON.stringify(g)),d()}else e("table-not-exist")},1)},clearTable:function(a,b){setTimeout(function(){window.localStorage.setItem(a,JSON.stringify([])),b()},1)},createTableIfNotExist:function(b,c,d,e,f){setTimeout(function(){var c=(e===!0?[]:a.Utils.getValidJSON(window.localStorage.getItem(b)))||[];if(a.Utils.isArray(d))for(var g=0;g<d.length;++g)d[g].id=a.Utils.getGUID(),c.push(d[g]);else d&&(d.id=a.Utils.getGUID(),c.push(d));window.localStorage.setItem(b,JSON.stringify(c)),f()},1)}},a.MemoryStoreConnector={memory:{},create:function(b,c,d){this.memory[b]=this.memory[b]||[],c.id=a.Utils.getGUID(),this.memory[b].push(c),d(c)},update:function(a,b,c,d,e){var f;if(this.memory[a]){for(var g=0;g<this.memory[a].length;++g)if(this.memory[a][g].id===b){for(var h in c)this.memory[a][g][h]=c[h];f=this.memory[a][g]}"undefined"==typeof f?e("record-not-exist"):d(f)}else e("table-not-exist")},get:function(a,b,c,d){var e=[],f=!0;if(this.memory[a]){if("object"==typeof b)for(var g=0;g<this.memory[a].length;++g){for(var h in b)this.memory[a][g][h]!==b[h]&&(f=!1);f===!0&&e.push(this.memory[a][g]),f=!0}else if("undefined"==typeof b||null===b||""===b)e=this.memory[a];else{e=void 0;for(var g=0;g<this.memory[a].length;++g)if(this.memory[a][g].id==b){e=this.memory[a][g];break}}c(e)}else d("table-not-exist")},remove:function(b,c,d,e){var f=!0;if(this.memory[b]){for(var g=this.memory[b].length;g--;)if("object"==typeof c){f=!0;for(var h in c)a.Utils.isArray(c[h])?-1==c[h].indexOf(this.memory[b][g][h])&&(f=!1):this.memory[b][g][h]!==c[h]&&(f=!1);f&&this.memory[b].splice(g,1)}else this.memory[b][g].id==c&&this.memory[b].splice(g,1);d()}else e("table-not-exist")},clearTable:function(a,b){this.memory[a]=[],b()},createTableIfNotExist:function(b,c,d,e,f){if(this.memory[b]=(e===!0?[]:this.memory[b])||[],a.Utils.isArray(d))for(var g=0;g<d.length;++g)d[g].id=a.Utils.getGUID(),this.memory[b].push(d[g]);else d&&(d.id=a.Utils.getGUID(),this.memory[b].push(d));f()}},a.Storage={connector:a.MemoryStoreConnector,create:function(a,b,c,d){this.connector.create(a,b,function(a){typeof c==typeof Function&&c(a)},function(a){typeof d==typeof Function&&d(a)})},update:function(a,b,c,d,e){this.connector.update(a,b,c,function(a){typeof d==typeof Function&&d(a)},function(a){typeof e==typeof Function&&e(a)})},get:function(a,b,c,d){this.connector.get(a,b,function(a){typeof c==typeof Function&&c(a)},function(a){typeof d==typeof Function&&d(a)})},remove:function(a,b,c,d){this.connector.remove(a,b,function(){typeof c==typeof Function&&c()},function(a){typeof d==typeof Function&&d(a)})},clearTable:function(a,b,c){this.connector.clearTable(a,function(){typeof b==typeof Function&&b()},function(a){typeof c==typeof Function&&c(a)})},createTableIfNotExist:function(a,b,c,d,e,f){this.connector.createTableIfNotExist(a,b,c,d,function(){typeof e==typeof Function&&e()},function(a){typeof f==typeof Function&&f(a)})},setupConnector:function(){a.Utils.hasFeature("openDatabase")?(a.SQLConnector.db=window.openDatabase(a.SQLConnector.dbOptions.name,a.SQLConnector.dbOptions.version,a.SQLConnector.dbOptions.display,a.SQLConnector.dbOptions.size),a.Storage.connector=a.SQLConnector):a.Storage.connector=a.Utils.hasFeature("localStorage")===!0?a.LocalStorageConnector:a.MemoryStoreConnector}},a.Storage.setupConnector(),a.Log=function(){a.Config.logging===!0&&console.log("[MAGNET DEBUG] ",a.Utils.isAndroid||a.Utils.isIOS?JSON.stringify(arguments)||arguments:arguments)},a.set=function(b){for(var c in b)if(b.hasOwnProperty(c)){if("endpointUrl"==c&&/^(ftp|http|https):/.test(b[c]===!1))throw"invalid endpointUrl - no protocol";a.Config[c]=b[c]}return this},a.reset=function(){return a.set({endpointUrl:"",logging:!0}),this},a.define=function(b){var c=require(b),d=c.Controllers?"Controllers":"Models";return a.Utils.mergeObj(a[d],c[d]),this},a.Geolocation={positionToRFC5870:function(a){return"undefined"!=typeof a&&null!==a&&a.coords?"geo:"+a.coords.latitude+","+a.coords.longitude+","+(a.coords.altitude?a.coords.altitude:0)+",crs=wgs84,u="+(a.coords.accuracy?Math.round(a.coords.accuracy):0):!1},isWithinPolygon:function(a,b){function c(a,b,c){var d=a.lng,e=a.lat,f=b.lng,g=b.lat,h=c.lng,i=c.lat;if(g>i&&(f=c.lng,g=c.lat,h=b.lng,i=b.lat),0>d&&(d+=360),0>f&&(f+=360),0>h&&(h+=360),(e==g||e==i)&&(e+=1e-8),e>i||g>e||d>Math.max(f,h))return!1;if(d<Math.min(f,h))return!0;var j=f!=h?(i-g)/(h-f):1/0,k=f!=d?(e-g)/(d-f):1/0;return k>=j}var d=0;if("undefined"==typeof a||!a.points)throw"The Geostore object provided is invalid";if("undefined"==typeof b)throw"The Geoentry object provided is invalid";for(var e=a.points,f=0;f<e.length;f++){var g=e[f],h=f+1;h>=e.length&&(h=0);var i=e[h];c(b,g,i)&&d++}return d%2==1},isWithinPointRadius:function(a,b,c){function d(a,b){var c=function(a){return a*Math.PI/180},d=c(b.lat-a.lat),e=c(b.lng-a.lng),f=Math.sin(d/2)*Math.sin(d/2)+Math.cos(c(a.lat))*Math.cos(c(b.lat))*Math.sin(e/2)*Math.sin(e/2),g=2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f));return 6378137*g}return c<=d(b,a)}},a.Transport={request:function(b,c,d,e,f){if(d=d||{},c._path=c._path||c.path,a.Config.endpointUrl=a.Config.endpointUrl.toLowerCase(),c._path=c.local===!0||/^(ftp|http|https):/.test(c._path)===!0?c._path:a.Config.endpointUrl+c._path,c.contentType="application/json"==c.contentType?"application/json; magnet-type=controller-params":c.contentType,a.Utils.isNode)this.initNodeRequest(b,c,d,e,f);else if(a.Utils.isCordova&&d.callOptions&&d.callOptions.saveAs&&!d.callOptions.returnRaw)this.cordovaFileTransfer(b,c,d,e,f);else if("undefined"==typeof jQuery||a.Utils.isBinaryType(c.returnType)||c.isBinary){if("undefined"===XMLHttpRequest)throw"request-transport-unavailable";this.requestXHR(b,c,d,e,f)}else this.requestJQuery(b,c,d,e,f)},requestJQuery:function(b,c,d,e,f){var g=this,h=g.parseBody(c.contentType,b);$.support.cors=!0;var i={body:h,info:{url:c._path}};d.call.transportHandle=$.ajax({type:c.method,url:c._path,timeout:3e4,dataType:c.dataType,contentType:c.contentType,data:h,beforeSend:function(a){if(c.headers)for(var b=c.headers.length;b--;)a.setRequestHeader(c.headers[b].name,c.headers[b].val);a.setRequestHeader("Accept",g.createAcceptHeader(c.dataType))},success:function(b,c,d){typeof e==typeof Function&&(i.info.xhr=a.Utils.convertHeaderStrToObj(d),i.contentType=d.getResponseHeader("Content-Type"),i.status=d.status,b=b.result||b,e(b,i))},error:function(b,c){i.info.xhr=a.Utils.convertHeaderStrToObj(b),i.contentType=b.getResponseHeader("Content-Type"),i.status=b.status,"parsererror"==c?e(b.responseText,i):typeof f==typeof Function&&f(b.responseText,i)}})},requestXHR:function(b,c,d,e,f){var g,h=this,i=h.parseBody(c.contentType,b),j={body:i,info:{url:c._path}};d.call.transportHandle=new XMLHttpRequest;var k=d.call.transportHandle;if(k.timeout=3e4,a.Utils.isBinaryType(c.returnType)&&k.overrideMimeType("text/plain; charset=x-user-defined"),k.onreadystatechange=function(){if(4==k.readyState){if(j.status=k.status,j.contentType=k.getResponseHeader("Content-Type"),j.info.xhr=a.Utils.convertHeaderStrToObj(k),g=k.responseText,"undefined"!=typeof k.responseXML&&null!=k.responseXML)g=k.responseXML;else try{g=JSON.parse(g),g=g.result}catch(b){}h.isSuccess(k.status)?(a.Utils.isBinaryType(c.returnType)&&(g={mimeType:j.contentType,val:g}),typeof e==typeof Function&&e(g,j)):typeof f==typeof Function&&f(g,j)}},k.ontimeout=function(){j.status=0,j.contentType=k.getResponseHeader("Content-Type"),j.info.xhr=a.Utils.convertHeaderStrToObj(k),typeof f==typeof Function&&f("request-timeout",j)},k.open(c.method,c._path,!0),c.contentType&&k.setRequestHeader("Content-Type",c.contentType),k.setRequestHeader("Accept",h.createAcceptHeader(c.dataType)),c.headers)for(var l=c.headers.length;l--;)k.setRequestHeader(c.headers[l].name,c.headers[l].val);k.send(i)},initNodeRequest:function(b,c,d,e,f){var g=require("url"),h=g.parse(c._path),i=a.Utils.mergeObj({"Content-Type":c.contentType},a.Transport.Headers);if(c.headers)for(var j=c.headers.length;j--;)i[c.headers[j].name]=c.headers[j].val;c.protocol=h.protocol,h.hostname?this.requestNode(b,c,{host:h.hostname,port:parseInt(h.port||("https:"==h.protocol?443:null)),path:h.path,method:c.method,rejectUnauthorized:!1,requestCert:!1,headers:i},d,e,f):typeof f==typeof Function&&f("error-parsing-url",{body:b,info:{url:c._path}})},requestNode:function(b,c,d,e,f,g){var h=this,i=require("http"),j=require("https"),k=h.parseBody(c.contentType,b);e.call.transportHandle=("https:"==c.protocol?j:i).request(d,function(b){var d="",i={body:k,info:{metadata:c,url:c._path,request:e.call.transportHandle,response:b},contentType:b.headers["content-type"],status:b.statusCode};b.setEncoding(a.Utils.isBinaryType(c.returnType)?"binary":"utf8"),b.on("data",function(a){d+=a}),b.on("end",function(){try{d=JSON.parse(d),d=d.result||d}catch(e){}h.isSuccess(b.statusCode)?(a.Utils.isBinaryType(c.returnType)&&(d={mimeType:i.contentType,val:d}),typeof f==typeof Function&&f(d,i)):typeof g==typeof Function&&g(d,i)})}),e.call.transportHandle.on("error",function(a){if(typeof g==typeof Function){var d={body:b,info:{metadata:c,url:c._path,request:e.call.transportHandle},status:0};g(a,d)}}),b&&e.call.transportHandle.write(k,c.isBinary===!0?"binary":"utf8"),e.call.transportHandle.end()},isSuccess:function(a){return a>=200&&299>=a},parseBody:function(b,c){var d=a.Utils.isNode?require("querystring"):a.Utils.objectToFormdata;switch(b){case"application/x-www-form-urlencoded":c=d.stringify(c);break;case"application/json":c=JSON.stringify(c);break;case"application/json; magnet-type=controller-params":c=JSON.stringify(c)}return c},createAcceptHeader:function(a){var b="";switch(a=a||"json"){case"xml":b="application/xml;q=1.0";break;case"html":b="text/plain;q=1.0";break;case"text":b="text/plain;q=1.0";break;case"json":b="application/json; magnet-type=controller-result";break;default:b="*/*;q=1.0"}return b},cordovaFileTransfer:function(b,c,d,e,f){var g={body:b,info:{url:c._path},status:null},h={};if(c.headers)for(var i=c.headers.length;i--;)h[c.headers[i].name]=c.headers[i].val;a.FileManager.getFS(function(b,i){d.call.transportHandle=new FileTransfer,d.call.transportHandle.download(c._path,i+d.callOptions.saveAs,function(a){typeof e==typeof Function&&e(a,g)},function(a,b,c,d){g.status=d,typeof f==typeof Function&&f(a,g)},a.Config.debugMode,{headers:h})},function(){typeof f==typeof Function&&f(a.FileManager.status,g)})}},a.Transport.Headers={},a.Request=function(b,c,d){this.instance=b,this.options=c,this.metadata=d,this.options.callOptions=this.options.callOptions||new a.CallOptions,this.options.call=this.options.call||new a.Call,this.options.call.setOptions(this.options.callOptions)},a.Request.prototype.send=function(b,c){var d=this;setTimeout(function(){d.beforeRequest(b,c,function(){d.metadata.params.contentType=d.metadata.params.contentType||(d.metadata.params.consumes?d.metadata.params.consumes[0]:void 0)||"application/json";var e=d.setup(d.metadata.schema||{},d.metadata.params,d.options.attributes);if(e.params.headers=e.params.headers||[],a.Utils.isCordova&&typeof device==typeof{}&&device.uuid&&(e.params.headers.push({name:"X-Magnet-Device-Id",val:device.uuid}),e.params.headers.push({name:"User-Agent",val:device.platform+" "+device.version+" "+device.model+" "+navigator.userAgent})),a.Utils.isNode||e.params.headers.push({name:"X-Magnet-Auth-Challenge",val:"disabled"}),d.options&&d.options.callOptions&&d.options.callOptions.callId&&d.options.callOptions.isReliable&&(e.params.headers.push({name:"X-Magnet-Correlation-id",val:d.options.callOptions.callId}),e.params.headers.push({name:"X-Magnet-Result-Timeout",val:d.options.callOptions.serverTimeout||0})),e.params.produces&&"multipart/related"===e.params.produces[0]&&e.params.headers.push({name:"Accept",val:"multipart/related"}),d.options&&d.options.callOptions&&d.options.callOptions.headers)for(var f in d.options.callOptions.headers)e.params.headers.push({name:f,val:d.options.callOptions.headers[f]});d.options.call.state=a.CallState.EXECUTING,a.Transport.request(e.body,e.params,d.options,function(e,f){"MMSDKLoginService"==d.metadata.params.controller&&"login"==d.metadata.params.name&&"SUCCESS"!=e?(d.options.call.state=a.CallState.FAILED,d.onResponseError(b,c,e,f)):(d.options.call.state=a.CallState.SUCCESS,d.onResponseSuccess(b,e,f))},function(e,f){d.options.call.state=a.CallState.FAILED,d.onResponseError(b,c,e,f)})})},1)},a.Request.prototype.setup=function(e,f,g){var h="",i={},j={},l={},m="",n=!1;f.dataType=f.dataType||"json",f._path=f.path;var o="multipart/related"==f.contentType?new a.Multipart:void 0,p=k(g,o,void 0,e);for(var q in p)if(p.hasOwnProperty(q)&&e[q])if("_data"!=e[q].type&&"binary"!=e[q].type||"undefined"!=typeof o)switch(e[q].style){case"TEMPLATE":f._path=b(f._path,q,p[q]);break;case"QUERY":h+=c(q,p[q]);break;case"PLAIN":"DELETE"===this.metadata.params.method||"GET"===this.metadata.params.method?h+=c(q,p[q]):j[q]=p[q];break;case"HEADER":f.headers=f.headers||[],f.headers.push({name:q,val:p[q]});break;case"MATRIX":f._path=b(f._path,q,d(q,p[q]));break;case"FORM":f.contentType="application/x-www-form-urlencoded","DELETE"===this.metadata.params.method||"GET"===this.metadata.params.method?h+=c(q,p[q]):l[q]=p[q]}else n=q;a.Utils.getAttributes(j);return n?(f.isBinary=!0,f.contentType=p[n].mimeType,i=p[n].val):i=a.Utils.mergeObj(j,l),"undefined"!=typeof o&&(i=o.close(i)),f._path=(f.basePathOnly===!0?f._path:"/rest"+f._path)+m+h,f._path=-1==f._path.indexOf("?")?f._path.replace("&","?"):f._path,{body:i,params:f}},a.Request.prototype.beforeRequest=function(b,c,d){var e=this,f=a.CallManager.getCacheByHash(this.getCallHash());if(f)e.options.call.state=a.CallState.SUCCESS,e.options.call.result=f.result,e.options.call.details=f.details,e.options.call.isResultFromCache=!0,typeof b==typeof Function&&b(f.result,f.details,!0);else{var g=this.options.callOptions;g&&a.CallManager.isConstraintMet(g.constraint)===!1?g.isReliable===!0&&a.CallManager.isExpired(g.requestAge)===!1?(a.CallManager.setRequestObject(e.options.call.callId,e.options,e.metadata),e.options.call.state=a.CallState.QUEUED,typeof b==typeof Function&&b("awaiting-constraint")):(e.options.call.state=a.CallState.FAILED,typeof c==typeof Function&&c("constraint-failure",{constraint:g.constraint,current:a.CallManager.getConnectionState()})):a.Utils.isCordova&&"NONE"==a.CallManager.getConnectionState()?(e.options.call.state=a.CallState.FAILED,typeof c==typeof Function&&c("no-network-connectivity")):d()}},a.Request.prototype.onResponseSuccess=function(b,c,d){var e=this;e.options.callOptions&&0!=e.options.callOptions.cacheAge&&(e.options.call.cachedTime=new Date,a.CallManager.setCacheObject(e.options.call.callId,e.getCallHash(),e.options.callOptions,c,d)),e.formatResponse(c,d,function(a){e.options.call.result=a,e.options.call.details=d,e.instance&&e.instance.invoke(["Complete","Success","MMSDKComplete"],e.metadata.params.name,a,d),typeof b==typeof Function&&b(a,d)})},a.Request.prototype.onResponseError=function(b,c,d,e){if(403==e.status&&a.Utils.isCordova===!0&&"string"==typeof d&&-1!=d.indexOf("com.magnet.security.api.oauth.OAuthLoginException")){var f=a.Utils.getValidJSON(d);a.OAuthHandler.invoke("OAuthLoginException",this.instance,this.options,this.metadata,f,b,c)}else this.options.call.resultError=d,this.options.call.details=e,(401==e.status||403==e.status)&&(d="session-expired",a.LoginService.connectionStatus="Unauthorized",a.LoginService.invoke(["Unauthorized"],this.metadata.params.name,d,e)),this.instance&&this.instance.invoke(["Complete","Error","MMSDKComplete"],this.metadata.params.name,d,e),typeof c==typeof Function&&c(d,e)},a.Request.prototype.getCallHash=function(){try{return a.CallManager.getCallHash(this.metadata.params.controller,this.metadata.params.name,JSON.stringify(this.options.attributes)||"")}catch(b){return!1}},a.Request.prototype.formatResponse=function(b,c,d){var e=this.metadata.params,g=this.options.callOptions||{},h=b;g.returnRaw||"undefined"==typeof h?d(h):"date"==e.returnType?d(a.Utils.ISO8601ToDate(b)):g.saveAs&&a.Utils.isCordova===!1?a.Utils.isNode?require("fs").writeFile(g.saveAs,"string"==typeof b?b:JSON.stringify(b),a.Utils.mergeObj({encoding:"binary",mode:438,flag:"w"},g.saveAsOptions),function(b){b&&a.Log(b),d(h)}):(a.Log("The saveAs option is only compatible with Phonegap or Node.js applications."),d(h)):d(a.Utils.isModelOrCollection(e.returnType)===!0?this.jsonToModel(e.returnType,b):a.Utils.isDateType(e.returnType)?a.Utils.ISO8601ToDate(h):"bytearray"==e.returnType?a.Utils.base64ToString(h):"string"==typeof b&&-1!=b.indexOf("--BOUNDARY--")?f(b):h)},a.Request.prototype.jsonToModel=function(b,c,d){var g=e(b);if(a.Models[g]&&-1!=b.indexOf("[]")&&c&&a.Utils.isArray(c))c=new a.Collection(g,c);else if(a.Models[g]&&a.Utils.isArray(c))for(var h=0;h<c.length;++h)c[h]=this.jsonToModel(g,c[h]);else if(a.Models[g]&&a.Utils.isObject(c)&&c["magnet-type"]){c=new a.Models[g](c);for(var i in c.attributes)c.schema[i]&&(c.attributes[i]=this.jsonToModel(e(c.schema[i].type),c.attributes[i]))}else if("bytearray"==g)c=a.Utils.base64ToString(c);else if(a.Utils.isDateType(g))c=a.Utils.ISO8601ToDate(j);else if(!d&&"string"==typeof c&&-1!=c.indexOf("--BOUNDARY--")){var j=f(c);
c=a.Utils.isObject(j)?this.jsonToModel(g,j):j}return c},a.Multipart=function(){this.boundary="BOUNDARY",this.message="",this.prefix="DATA_",this.index=0},a.Multipart.prototype.add=function(b,c){var d=this.prefix+String(++this.index);return this.message+="--"+this.boundary+"\r\n",this.message+="Content-Type: "+b+"\r\n",this.message+="Content-Transfer-Encoding: base64\r\n",this.message+="Content-Id: "+d+"\r\n\r\n",this.message+=a.Utils.stringToBase64(c)+"\r\n\r\n",d},a.Multipart.prototype.close=function(a){return this.message+="--"+this.boundary+"--",this.message="--"+this.boundary+"\r\nContent-Type: application/json\r\n\r\n"+JSON.stringify(a)+"\r\n\r\n"+this.message,this.message},a.Model=function(b,c){a.Events.create(this),this.attributes=this.attributes||{};for(var d in this.attributes)null===this.attributes[d]&&delete this.attributes[d];return this.attributes["magnet-type"]=this.entityType,b&&this.set(b,c),this.isMagnetModel=!0,this},a.Model.prototype.validate=function(b,c){return a.Utils.validate(this.schema,b,c)},a.Model.prototype.set=function(b,c){if(c){var d=this.validate(b);return d===!1?(this.attributes=a.Utils.mergeObj(this.attributes,b),this.invoke("onSet",this.name,b)):a.Log('model "'+this.name+'" validation failure:'+JSON.stringify(d)),d?d:!1}return this.attributes=a.Utils.mergeObj(this.attributes,b),this.invoke("onSet",this.name,b),!1},a.Collection=function(b,c){return this._type=b,this.entityType=a.Models[this._type]?a.Models[this._type].entityType:b,this.models=[],c&&this.add(c),this.isMagnetCollection=!0,this},a.Collection.prototype.add=function(b){if(a.Utils.isArray(b))for(var c=0;c<b.length;++c)b[c].isMagnetModel||(b[c]["magnet-type"]=this.entityType),this.models.push(b[c].isMagnetModel?b[c]:new a.Models[this._type](b[c]));else b.isMagnetModel||(b["magnet-type"]=this.entityType),this.models.push(b.isMagnetModel?b:new a.Models[this._type](b))},a.Collection.prototype.clear=function(){this.models=[]},a.Collection.prototype.where=function(b,c){for(var d=[],e=0;e<this.models.length;++e)if(a.Utils.isObject(b)){var f=!0;for(var g in b)b.hasOwnProperty(g)&&(this.models[e].attributes[g]&&this.models[e].attributes[g]===b[g]||(f=!1));f&&d.push(this.models[e])}else c&&this.models[e].attributes[b]===c&&d.push(this.models[e]);return d},a.Models={},a.Controller=function(b){return this._MMSDKName=b,a.Events.create(this),this},a.Method=function(b,c,d){var e=this;c=c||{},c.attributes="undefined"==typeof b||null===b?void 0:b,c.attributes=a.Utils.mergeObj(c.attributes,d.attributes);var f=a.Utils.validate(d.schema,c.attributes),g=new a.Deferred;if(g.promise=new a.Call,c.call=g.promise,d.params.controller=e._MMSDKName,c.callOptions&&c.callOptions.skipValidation===!0||f===!1){e.invoke(["Set"],d.params.name,c,d);var h=new a.Request(e,c,d);e.invoke(["BeforeRequest"],d.params.name,c,d),h.send(function(){typeof c.success==typeof Function&&c.success.apply(e,arguments),g.resolve.apply(g,arguments)},function(){typeof c.error==typeof Function&&c.error.apply(e,arguments),g.reject.apply(g,arguments)})}else e.invoke(["Complete","Error"],d.params.name,"failed-validation",f),a.Log('controller method "'+d.params.name+'" validation failure:'+JSON.stringify(f)),typeof c.error==typeof Function&&c.error("failed-validation",f),g.reject("failed-validation",f);return g.promise},a.Controllers={},a.LoginService=new a.Controller("MMSDKLoginService"),a.LoginService.store="MMSDKConnection",a.LoginService.connectionStatus="NoAuthorization",a.LoginService.login=function(b,c){return a.Method.call(this,b,c,{params:{name:"login",path:"/login",method:"POST",dataType:"html",contentType:"application/x-www-form-urlencoded",returnType:"string"},attributes:{authority:"magnet"},schema:{name:{style:"FORM",type:"java.lang.String",optional:!1},password:{style:"FORM",type:"java.lang.String",optional:!1},authority:{style:"FORM",type:"java.lang.String",optional:!0}}})},a.LoginService.logout=function(b){return a.Method.call(this,null,b,{params:{name:"logout",path:"/logout",method:"POST",dataType:"html",returnType:"void"}})},a.LoginService.loginWithSavedCredentials=function(b){var c=this;a.Storage.get(c.store,null,function(d){var e=d&&d.length>0?a.Utils.getValidJSON(a.Utils.base64ToString(d[0].hash)):{};e.name&&e.password&&e.endpointUrl&&e.authority?(a.set({endpointUrl:e.endpointUrl}),delete e.endpointUrl,c.login(e,{success:b.success,error:b.error})):typeof b.error==typeof Function&&b.error("invalid-credentials")},b.error)},a.LoginService.on("MMSDKComplete",function(b,c,d){if("login"==b&&"SUCCESS"==c){if(a.LoginService.connectionStatus="Authorized",a.LoginService.invoke(["Authorized"],c,d),a.Utils.isMobile&&a.Config.storeCredentials===!0){var e=JSON.parse('{"'+decodeURI(d.body).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}');a.Storage.createTableIfNotExist(this.store,{hash:"TEXT"},{hash:a.Utils.stringToBase64(JSON.stringify(a.Utils.mergeObj({endpointUrl:a.Config.endpointUrl},e)))},!0)}a.Utils.isNode&&d.info.response.headers["set-cookie"]&&(a.Transport.Headers.Cookie=d.info.response.headers["set-cookie"][0])}else"logout"==b&&(a.LoginService.connectionStatus="NoAuthorization",a.LoginService.invoke(["NoAuthorization"],c,d),a.Utils.isMobile&&a.Storage.clearTable(this.store),a.Utils.isNode&&delete a.Transport.Headers.Cookie)});var m=m||{UNKNOWN:"unknown",ETHERNET:"ethernet",WIFI:"wifi",CELL_2G:"2g",CELL_3G:"3g",CELL_4G:"4g",CELL:"cellular",NONE:"none"};a.OAuthHandler={authorize:function(b){if(!b||!b.endpoint)throw"no endpoint specified";var c=window.open(b.endpoint,"_blank","location=no,toolbar=no");"undefined"!=typeof c?c.addEventListener("loadstop",function(a){var d=/MagnetOAuthServlet\?code=(.+)$/.exec(a.url),e=/\?error=(.+)$/.exec(a.url)||/\?error_code=(.+)$/.exec(a.url)||null;(d||e)&&c.close(),d&&typeof b.success==typeof Function&&b.success(a.url,a),e&&typeof b.error==typeof Function&&b.error(e[1],a)},!0):(a.Log("OAuth handling error: no InAppBrowser. Install the org.apache.cordova.inappbrowser plugin to handle Oauth."),typeof b.error==typeof Function&&b.error("missing-oauth-plugin",b.endpoint))}},a.Events.create(a.OAuthHandler),a.OAuthHandler.on("OAuthLoginException",function(b,c,d,e,f,g){a.OAuthHandler.invoke("OAuthLoginExceptionReceived",b,c,d,e),a.OAuthHandler.authorize({endpoint:e.message,success:function(){a.OAuthHandler.invoke("OAuthFlowComplete",b,c,d);var e=new a.Request(b,c,d);e.send(f,g)},error:function(a,b){typeof g==typeof Function&&g("oauth-flow-error",{error:a,details:b})}})}),a.CallManager={queueTableName:"MMSDKReliableQueues",defaultQueueName:"MMSDKDefault",queues:{},cache:{}},a.Storage.createTableIfNotExist(a.CallManager.queueTableName,{callId:"TEXT",callOptions:"TEXT",options:"TEXT",metadata:"TEXT",queueName:"TEXT"},null,!1,l),a.CallManager.clearCache=function(a){a&&this.cache[a]?delete this.cache[a]:this.cache={}},a.CallManager.cancelAllPendingCalls=function(b,c){b&&this.queues[b]?(delete this.queues[b],a.Storage.remove(this.queueTableName,{queueName:b},c)):(this.queues={},a.Storage.clearTable(this.queueTableName,c))},a.CallManager.reset=function(a){this.clearCache(),this.cancelAllPendingCalls(void 0,a)},a.CallManager.run=function(b){function c(){f.length>0&&a.Storage.remove(d.queueTableName,{id:f},b)}var d=this,e=0,f=[];if(a.Utils.isEmptyObject(d.queues))c();else for(var g in d.queues)d.queues.hasOwnProperty(g)&&(++e,d.runQueue(g,[],function(a){setTimeout(function(){f=f.concat(a),0==--e&&c()},1)}))},a.CallManager.removeCallFromQueue=function(a,b){for(var c in this.queues)if(this.queues.hasOwnProperty(c))for(var d=0;d<this.queues[c].length;++d)if(this.queues[c][d].callId===a){this.queues[c].splice(d,1);break}b()},a.CallManager.disposeAllDoneCalls=function(b,c,d){var e=[];for(var f in this.cache)e.push(f);a.CallManager.requestCorrelationCleanup(e,function(d,e){b===!0&&a.CallManager.clearCache(),c(d,e)},d)},a.CallManager.getCall=function(a){var b;for(var c in this.queues)if(this.queues.hasOwnProperty(c))for(var d=0;d<this.queues[c].length;++d)if(this.queues[c][d].callId===a){b=this.queues[c][d].options.call;break}return b},a.CallManager.runQueue=function(b,c,d){var e=this,f=e.queues[b];if(a.Utils.isArray(f)&&f.length>0)if(e.isExpired(f[0].callOptions.requestAge)===!0)c.push(f[0].id),f.shift(),e.runQueue(b,c,d);else if(e.isConstraintMet(f[0].callOptions.constraint)){var g=new a.Request(void 0,f[0].options,f[0].metadata);g.send(function(g,h){a.ReliableCallListener.invoke(["onSuccess",f[0].callOptions.success],f[0].metadata.params,g,h),c.push(f[0].id),f.shift(),e.runQueue(b,c,d)},function(g,h){a.ReliableCallListener.invoke(["onError",f[0].callOptions.error],f[0].metadata.params,g,h),c.push(f[0].id),f.shift(),e.runQueue(b,c,d)})}else e.queues[b]=f,d(c);else delete e.queues[b],d(c)},a.CallManager.setRequestObject=function(b,c,d,e){var f=c.callOptions.queueName&&""!=c.callOptions.queueName?c.callOptions.queueName:this.defaultQueueName,g=this.queues[f];g=g||[],g.push({callId:b,callOptions:c.callOptions,options:c,metadata:d,queueName:f});var h={callId:g[g.length-1].callId,callOptions:JSON.stringify(g[g.length-1].callOptions),options:JSON.stringify(g[g.length-1].options),metadata:JSON.stringify(g[g.length-1].metadata),queueName:g[g.length-1].queueName};delete h.options.callOptions,this.queues[f]=g,a.Storage.create(this.queueTableName,h,e)},a.CallManager.setCacheObject=function(a,b,c,d,e){this.cache[a]={callOptions:c,callHash:b,result:d,details:e||{}}},a.CallManager.getCacheByHash=function(a){var b;for(var c in this.cache)this.cache[c].callHash===a&&(!this.isExpired(this.cache[c].callOptions.cacheAge)||this.cache[c].callOptions.ignoreAgeIfOffline!==!1&&"NONE"==this.getConnectionState()||delete this.cache[c],b=this.cache[c]);return b},a.CallManager.getCallHash=function(){var a=[].slice.call(arguments).join("|");return n?n.MD5(a).toString():encodeURIComponent(a)},a.CallManager.getTimeInSeconds=function(){return Math.round((new Date).getTime()/1e3)},a.CallManager.isExpired=function(a){return this.getTimeInSeconds()>=a},a.CallManager.set=function(a,b){a=a||this;for(var c in b)b.hasOwnProperty(c)&&("cacheTimeout"==c?a.setCacheTimeout(b[c]):"requestTimeout"==c&&a.setRequestTimeout?a.setRequestTimeout(b[c]):a[c]=b[c])},a.CallManager.isConstraintMet=function(b){if(b&&a.Utils.isArray(b)){for(var c=[],d=!0,e=!0,f=this.getConnectionState(),g=(a.Geolocation.current,0);g<b.length;++g)"string"==typeof b[g]?c.push(b[g]):typeof b[g]==typeof Function&&(e=b[g]());return(c.length>0?-1!=c.indexOf(f):!0)&&d===!0&&e===!0}return!0},a.CallManager.getConnectionState=function(){var b="WIFI";if(a.Utils.isObject(navigator)&&navigator.connection&&navigator.connection.type){var c=navigator.connection.type;switch(c){case m.ETHERNET:b="WIFI";break;case m.WIFI:b="WIFI";break;case m.CELL:b="CELL";break;case m.CELL_2G:b="CELL";break;case m.CELL_3G:b="CELL";break;case m.CELL_4G:b="CELL";break;case m.NONE:b="NONE";break;default:b=c}}return b},a.CallManager.requestCorrelationCleanup=function(b,c,d){a.Transport.request(null,{method:"GET",path:"/_magnet_cc?ids="+("string"==typeof b?b:b.join(","))},{call:new a.Call},c,d)},a.Call=function(){this.callId,this.token,this.cachedTime,this.isResultFromCache,this.result,this.resultError,this.details,this.state=a.CallState.INIT,a.Promise.apply(this,arguments)},a.Call.prototype=new a.Promise,a.Call.prototype.constructor=a.Call,a.Call.prototype.setOptions=function(a){this.token=a.token,this.callId=a.callId,this.isReliable=a.isReliable},a.Call.prototype.cancel=function(b){this.state!=a.CallState.SUCCESS&&this.state!=a.CallState.FAILED?(this.transportHandle&&this.transportHandle.abort(),this.state=a.CallState.CANCELLED,a.CallManager.removeCallFromQueue(this.callId,function(){typeof b==typeof Function&&b(!0)})):typeof b==typeof Function&&b(!1)},a.Call.prototype.dispose=function(b,c,d){var e=this.callId;!e||this.state!==a.CallState.FAILED&&this.state!==a.CallState.SUCCESS?typeof d==typeof Function&&d("invalid-call-state"):a.CallManager.requestCorrelationCleanup(e,function(d,f){1==b&&a.CallManager.clearCache(e),c(d,f)},d)},a.CallState={INIT:"init",EXECUTING:"executing",QUEUED:"queued",CANCELLED:"cancelled",SUCCESS:"success",FAILED:"failed"},a.ReliableCallListener={on:function(){},unbind:function(){}},a.ReliableCallListener={},a.Events.create(a.ReliableCallListener),a.CallOptions=function(b){this.callId=a.Utils.getGUID(),this.constraint,this.token,this.cacheAge=0,this.headers=void 0,this.ignoreAgeIfOffline=!1,this.skipValidation=!1,b&&a.CallManager.set(this,b)},a.CallOptions.prototype.setCacheTimeout=function(b,c){this.cacheAge=b?a.CallManager.getTimeInSeconds()+b:0,this.ignoreAgeIfOffline=c},a.CallOptions.prototype.addTag=function(a,b){this.headers=this.headers||{},this.headers[a]=b},a.CallOptions.prototype.addTags=function(b){this.headers=this.headers||{},a.Utils.mergeObj(this.headers,b)},a.AsyncCallOptions=function(){a.CallOptions.apply(this,arguments)},a.AsyncCallOptions.prototype=new a.CallOptions,a.AsyncCallOptions.prototype.constructor=a.AsyncCallOptions,a.ReliableCallOptions=function(){this.queueName,this.serverTimeout=0,this.requestAge=0,this.success,this.error,this.isReliable=!0,a.CallOptions.apply(this,arguments)},a.ReliableCallOptions.prototype=new a.CallOptions,a.ReliableCallOptions.prototype.constructor=a.ReliableCallOptions,a.ReliableCallOptions.prototype.setRequestTimeout=function(b){this.serverTimeout=1e3*b+3e4,this.requestAge=b?a.CallManager.getTimeInSeconds()+b:0},a.Constraints={Wifi:["WIFI"],WWAN:["CELL"],createConstraint:function(a,b){this[a]=b}},a.FileManager={fileSystem:null,filePath:null,status:!1,tempFile:"_magnet_temp.txt",getFS:function(b,c){var d=this;d.fileSystem&&d.filePath?b(d.fileSystem,d.filePath):d.status!==!1&&"OK"!=d.status?c():a.Utils.isCordova&&window.requestFileSystem&&"undefined"!=typeof FileTransfer?window.requestFileSystem(LocalFileSystem.TEMPORARY,0,function(a){d.fileSystem=a,d.fileSystem.root.getFile(d.tempFile,{create:!0,exclusive:!1},function(a){d.filePath=a.toURL?a.toURL().replace(d.tempFile,""):a.fullPath.replace(d.tempFile,""),a.remove(),d.status="OK",b(d.fileSystem,d.filePath)},function(a){d.status=a,c()})},function(a){d.status=a,c()}):(d.status===!1&&a.Log('The "org.apache.cordova.file-transfer" Phonegap plugin has not been added.'),d.status="FAILED",c())},writeFile:function(a,b,c,d){this.fileSystem.root.getFile(a,{create:!0,exclusive:!1},function(a){a.createWriter(function(d){d.onwrite=function(){c(a)},d.write(b)},d)},d)}},a.Geoentry=function(a,b){this.lat=a,this.lng=b},a.Geostore=function(a){this.points=a||[]},a.Geostore.prototype.add=function(b,c){this.points.push(new a.Geoentry(b,c))};/*!
 CryptoJS v3.1.2
 code.google.com/p/crypto-js
 (c) 2009-2013 by Jeff Mott. All rights reserved.
 code.google.com/p/crypto-js/wiki/License
 */
var n=n||function(a,b){var c={},d=c.lib={},e=function(){},f=d.Base={extend:function(a){e.prototype=this;var b=new e;return a&&b.mixIn(a),b.hasOwnProperty("init")||(b.init=function(){b.$super.init.apply(this,arguments)}),b.init.prototype=b,b.$super=this,b},create:function(){var a=this.extend();return a.init.apply(a,arguments),a},init:function(){},mixIn:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},g=d.WordArray=f.extend({init:function(a,c){a=this.words=a||[],this.sigBytes=c!=b?c:4*a.length},toString:function(a){return(a||i).stringify(this)},concat:function(a){var b=this.words,c=a.words,d=this.sigBytes;if(a=a.sigBytes,this.clamp(),d%4)for(var e=0;a>e;e++)b[d+e>>>2]|=(c[e>>>2]>>>24-8*(e%4)&255)<<24-8*((d+e)%4);else if(65535<c.length)for(e=0;a>e;e+=4)b[d+e>>>2]=c[e>>>2];else b.push.apply(b,c);return this.sigBytes+=a,this},clamp:function(){var b=this.words,c=this.sigBytes;b[c>>>2]&=4294967295<<32-8*(c%4),b.length=a.ceil(c/4)},clone:function(){var a=f.clone.call(this);return a.words=this.words.slice(0),a},random:function(b){for(var c=[],d=0;b>d;d+=4)c.push(4294967296*a.random()|0);return new g.init(c,b)}}),h=c.enc={},i=h.Hex={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;a>d;d++){var e=b[d>>>2]>>>24-8*(d%4)&255;c.push((e>>>4).toString(16)),c.push((15&e).toString(16))}return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;b>d;d+=2)c[d>>>3]|=parseInt(a.substr(d,2),16)<<24-4*(d%8);return new g.init(c,b/2)}},j=h.Latin1={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;a>d;d++)c.push(String.fromCharCode(b[d>>>2]>>>24-8*(d%4)&255));return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;b>d;d++)c[d>>>2]|=(255&a.charCodeAt(d))<<24-8*(d%4);return new g.init(c,b)}},k=h.Utf8={stringify:function(a){try{return decodeURIComponent(escape(j.stringify(a)))}catch(b){throw Error("Malformed UTF-8 data")}},parse:function(a){return j.parse(unescape(encodeURIComponent(a)))}},l=d.BufferedBlockAlgorithm=f.extend({reset:function(){this._data=new g.init,this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=k.parse(a)),this._data.concat(a),this._nDataBytes+=a.sigBytes},_process:function(b){var c=this._data,d=c.words,e=c.sigBytes,f=this.blockSize,h=e/(4*f),h=b?a.ceil(h):a.max((0|h)-this._minBufferSize,0);if(b=h*f,e=a.min(4*b,e),b){for(var i=0;b>i;i+=f)this._doProcessBlock(d,i);i=d.splice(0,b),c.sigBytes-=e}return new g.init(i,e)},clone:function(){var a=f.clone.call(this);return a._data=this._data.clone(),a},_minBufferSize:0});d.Hasher=l.extend({cfg:f.extend(),init:function(a){this.cfg=this.cfg.extend(a),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(a){return this._append(a),this._process(),this},finalize:function(a){return a&&this._append(a),this._doFinalize()},blockSize:16,_createHelper:function(a){return function(b,c){return new a.init(c).finalize(b)}},_createHmacHelper:function(a){return function(b,c){return new m.HMAC.init(a,c).finalize(b)}}});var m=c.algo={};return c}(Math);!function(a){function b(a,b,c,d,e,f,g){return a=a+(b&c|~b&d)+e+g,(a<<f|a>>>32-f)+b}function c(a,b,c,d,e,f,g){return a=a+(b&d|c&~d)+e+g,(a<<f|a>>>32-f)+b}function d(a,b,c,d,e,f,g){return a=a+(b^c^d)+e+g,(a<<f|a>>>32-f)+b}function e(a,b,c,d,e,f,g){return a=a+(c^(b|~d))+e+g,(a<<f|a>>>32-f)+b}for(var f=n,g=f.lib,h=g.WordArray,i=g.Hasher,g=f.algo,j=[],k=0;64>k;k++)j[k]=4294967296*a.abs(a.sin(k+1))|0;g=g.MD5=i.extend({_doReset:function(){this._hash=new h.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(a,f){for(var g=0;16>g;g++){var h=f+g,i=a[h];a[h]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var g=this._hash.words,h=a[f+0],i=a[f+1],k=a[f+2],l=a[f+3],m=a[f+4],n=a[f+5],o=a[f+6],p=a[f+7],q=a[f+8],r=a[f+9],s=a[f+10],t=a[f+11],u=a[f+12],v=a[f+13],w=a[f+14],x=a[f+15],y=g[0],z=g[1],A=g[2],B=g[3],y=b(y,z,A,B,h,7,j[0]),B=b(B,y,z,A,i,12,j[1]),A=b(A,B,y,z,k,17,j[2]),z=b(z,A,B,y,l,22,j[3]),y=b(y,z,A,B,m,7,j[4]),B=b(B,y,z,A,n,12,j[5]),A=b(A,B,y,z,o,17,j[6]),z=b(z,A,B,y,p,22,j[7]),y=b(y,z,A,B,q,7,j[8]),B=b(B,y,z,A,r,12,j[9]),A=b(A,B,y,z,s,17,j[10]),z=b(z,A,B,y,t,22,j[11]),y=b(y,z,A,B,u,7,j[12]),B=b(B,y,z,A,v,12,j[13]),A=b(A,B,y,z,w,17,j[14]),z=b(z,A,B,y,x,22,j[15]),y=c(y,z,A,B,i,5,j[16]),B=c(B,y,z,A,o,9,j[17]),A=c(A,B,y,z,t,14,j[18]),z=c(z,A,B,y,h,20,j[19]),y=c(y,z,A,B,n,5,j[20]),B=c(B,y,z,A,s,9,j[21]),A=c(A,B,y,z,x,14,j[22]),z=c(z,A,B,y,m,20,j[23]),y=c(y,z,A,B,r,5,j[24]),B=c(B,y,z,A,w,9,j[25]),A=c(A,B,y,z,l,14,j[26]),z=c(z,A,B,y,q,20,j[27]),y=c(y,z,A,B,v,5,j[28]),B=c(B,y,z,A,k,9,j[29]),A=c(A,B,y,z,p,14,j[30]),z=c(z,A,B,y,u,20,j[31]),y=d(y,z,A,B,n,4,j[32]),B=d(B,y,z,A,q,11,j[33]),A=d(A,B,y,z,t,16,j[34]),z=d(z,A,B,y,w,23,j[35]),y=d(y,z,A,B,i,4,j[36]),B=d(B,y,z,A,m,11,j[37]),A=d(A,B,y,z,p,16,j[38]),z=d(z,A,B,y,s,23,j[39]),y=d(y,z,A,B,v,4,j[40]),B=d(B,y,z,A,h,11,j[41]),A=d(A,B,y,z,l,16,j[42]),z=d(z,A,B,y,o,23,j[43]),y=d(y,z,A,B,r,4,j[44]),B=d(B,y,z,A,u,11,j[45]),A=d(A,B,y,z,x,16,j[46]),z=d(z,A,B,y,k,23,j[47]),y=e(y,z,A,B,h,6,j[48]),B=e(B,y,z,A,p,10,j[49]),A=e(A,B,y,z,w,15,j[50]),z=e(z,A,B,y,n,21,j[51]),y=e(y,z,A,B,u,6,j[52]),B=e(B,y,z,A,l,10,j[53]),A=e(A,B,y,z,s,15,j[54]),z=e(z,A,B,y,i,21,j[55]),y=e(y,z,A,B,q,6,j[56]),B=e(B,y,z,A,x,10,j[57]),A=e(A,B,y,z,o,15,j[58]),z=e(z,A,B,y,v,21,j[59]),y=e(y,z,A,B,m,6,j[60]),B=e(B,y,z,A,t,10,j[61]),A=e(A,B,y,z,k,15,j[62]),z=e(z,A,B,y,r,21,j[63]);g[0]=g[0]+y|0,g[1]=g[1]+z|0,g[2]=g[2]+A|0,g[3]=g[3]+B|0},_doFinalize:function(){var b=this._data,c=b.words,d=8*this._nDataBytes,e=8*b.sigBytes;c[e>>>5]|=128<<24-e%32;var f=a.floor(d/4294967296);for(c[(e+64>>>9<<4)+15]=16711935&(f<<8|f>>>24)|4278255360&(f<<24|f>>>8),c[(e+64>>>9<<4)+14]=16711935&(d<<8|d>>>24)|4278255360&(d<<24|d>>>8),b.sigBytes=4*(c.length+1),this._process(),b=this._hash,c=b.words,d=0;4>d;d++)e=c[d],c[d]=16711935&(e<<8|e>>>24)|4278255360&(e<<24|e>>>8);return b},clone:function(){var a=i.clone.call(this);return a._hash=this._hash.clone(),a}}),f.MD5=i._createHelper(g),f.HmacMD5=i._createHmacHelper(g)}(Math),/*!
 *  window.btoa/window.atob shim
 */
function(){function a(a){this.message=a}var b="undefined"!=typeof exports?exports:this,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";a.prototype=Error(),a.prototype.name="InvalidCharacterError",b.btoa||(b.btoa=function(b){for(var d,e,f=0,g=c,h="";b.charAt(0|f)||(g="=",f%1);h+=g.charAt(63&d>>8-8*(f%1))){if(e=b.charCodeAt(f+=.75),e>255)throw new a("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");d=d<<8|e}return h}),b.atob||(b.atob=function(b){if(b=b.replace(/=+$/,""),1==b.length%4)throw new a("'atob' failed: The string to be decoded is not correctly encoded.");for(var d,e,f=0,g=0,h="";e=b.charAt(g++);~e&&(d=f%4?64*d+e:e,f++%4)?h+=String.fromCharCode(255&d>>(6&-2*f)):0)e=c.indexOf(e);return h})}()}("undefined"==typeof exports?this.MagnetJS||(this.MagnetJS={}):exports);